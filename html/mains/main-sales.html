<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>main-page-ceo</title>
    <link rel="stylesheet" href="/../../css/pages.css">
    <link rel="stylesheet" href="/../../css/menu.css">
    <link rel="stylesheet" href="/../../css/main-sales.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>

  <body>
    <div id="menu"></div>
  
    <div class="main-content">
      <h2>Καλωσήρθατε, <span id="fullname"></span>!</h2>
    </div>

        <!-- Στατιστικά Πωλήσεων -->
        <div class="stats-grid">
          <div class="stat-card">
            <h3>Μηνιαίες Πωλήσεις</h3>
            <p class="stat-value" id="monthly-sales">€0</p>
          </div>
          <div class="stat-card">
            <h3>Στόχος</h3>
            <p class="stat-value" id="sales-target">€0</p>
          </div>
          <div class="stat-card">
            <h3>Πραγματοποίηση Στόχου</h3>
            <p class="stat-value" id="target-progress">0%</p>
          </div>
        </div>
  
        <!-- Γράφημα Τάσεων -->
        <div class="chart-container">
          <canvas id="salesTrendChart"></canvas>
        </div>
  
        <!-- Πρόσφατες Συναλλαγές -->
        <div class="recent-orders">
          <h3>Πρόσφατες Παραγγελίες</h3>
          <div class="table-wrapper">
            <table id="orders-table">
              <thead>
                <tr>
                  <th>Α/Α</th>
                  <th>Πελάτης</th>
                  <th>Ποσό</th>
                  <th>Κατάσταση</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>

    <script>
    function loadUserData() { 
      const loggedUser = localStorage.getItem("loggedUser");
      fetch("../../json/user_info.json")
        .then(response => response.json())
        .then(users => {
          const user = users.find(u => u.username === loggedUser);
          if (user) {
            document.getElementById("fullname").textContent = user.fullname;
          } else {
            document.getElementById("fullname").textContent = "Χρήστης";
          }
        })
        .catch(error => {
          console.error("Σφάλμα κατά τη φόρτωση των δεδομένων:", error);
          document.getElementById("fullname").textContent = "Χρήστης";
      });
    }
            // Φόρτωση δεδομένων πωλήσεων
            const loadSalesData = () => {
        fetch("../../json/main-sales.json")
          .then(response => response.json())
          .then(data => {
            // Ενημέρωση στατιστικών
            document.getElementById("monthly-sales").textContent = `€${data.monthlySales.toLocaleString()}`;
            document.getElementById("sales-target").textContent = `€${data.target.toLocaleString()}`;
            document.getElementById("target-progress").textContent = 
              `${Math.round((data.monthlySales / data.target) * 100)}%`;

            // Αρχικοποίηση γραφήματος
            const ctx = document.getElementById('salesTrendChart').getContext('2d');
            new Chart(ctx, {
              type: 'line',
              data: {
                labels: data.chartLabels,
                datasets: [{
                  label: 'Ιστορικό Πωλήσεων',
                  data: data.chartData,
                  borderColor: '#007bff',
                  fill: false,
                  tension: 0.4
                }]
              },
              options: {
                responsive: true,
                plugins: {
                  legend: { position: 'bottom' }
                }
              }
            });

            // Συμπλήρωση πίνακα
            const tbody = document.querySelector('#orders-table tbody');
            tbody.innerHTML = data.recentOrders.map(order => `
              <tr>
                <td>#${order.id}</td>
                <td>${order.customer}</td>
                <td>€${order.amount.toLocaleString()}</td>
                <td><span class="status-badge ${order.status.toLowerCase()}">${order.status}</span></td>
              </tr>
            `).join('');
          })
          .catch(console.error);
      };

      // Αρχικοποίηση σελίδας
      document.addEventListener('DOMContentLoaded', () => {
        loadUserData();
        loadSalesData();
      });
    </script>
    
    <script src="../../javascript/menu-loader.js"></script>
    <script src="../../javascript/navigations.js"></script>
  </body>
</html>
<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Εργασίες</title>
  <style>
    /* Base Reset & Fonts */
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif; }
    body { background-color: #f4f7fb; color: #333; font-size: 16px; }

/* Navbar */
.navbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 30px;
  background-color: #007bff;
  box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
  border-radius: 12px;
  margin: 16px;
  color: white;
}

.logo {
  height: 60px;
  width: auto;
  object-fit: contain;
  flex-shrink: 0;
}

.navbar-menu-wrapper {
  display: flex;
  flex: 1;
  justify-content: center;
  align-items: center;
}

.navbar-menu {
  display: flex;
  gap: 18px;
  flex-wrap: wrap;
}

.navbar-menu a {
  text-decoration: none;
  color: white;
  font-size: clamp(16px, 1.3vw, 18px);
  padding: 6px 12px;
  border-radius: 6px;
  transition: all 0.3s;
}

.navbar-menu a:hover {
  background-color: rgba(255, 255, 255, 0);
}

.navbar-right {
  display: flex;
  align-items: center;
  gap: 12px;
  flex-wrap: wrap;
}

.profile-img {
  width: 45px;
  height: 45px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid white;
  flex-shrink: 0;
}

.welcome-text {
  font-size: clamp(14px, 1.1vw, 16px);
  color: #f4f4f4;
}

.logout-btn {
  background-color: #007bff;
  color: white;
  border: none;
  padding: 8px 14px;
  font-size: clamp(14px, 1.1vw, 16px);
  border-radius: 6px;
  cursor: pointer;
  transition: background-color 0.3s;
}

.logout-btn:hover {
  background-color: #003f8a;
}

.logout-btn::before {
  content: "↩ ";
}

@media (max-width: 768px) {
  .navbar {
    flex-direction: column;
    align-items: flex-start;
    gap: 14px;
  }
  
  .navbar-menu-wrapper {
    width: 100%;
    justify-content: space-between;
  }
  
  .navbar-menu {
    justify-content: center;
    width: 100%;
    margin-top: 10px;
  }
  
  .navbar-right {
    justify-content: flex-start;
    width: 100%;
    gap: 10px;
  }
}

    /* Main Content */
    .main-content { padding: 30px; max-width:1200px; margin:auto; }

    /* Tasks Header */
    .heading-row { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
    .heading-row h1 { font-size:2rem; color:#2a2a2a; }
    .btn-new-task { padding:8px 16px; background-color:#007bff; color:#fff; border:none; border-radius:6px; cursor:pointer; font-weight:bold; font-size:14px; transition:0.3s; }
    .btn-new-task:hover { background-color:#0056b3; }

    /* Search Bar */
    .search-bar { width:100%; max-width:400px; margin-bottom:30px; }
    .search-bar input { width:100%; padding:10px 14px; border:1px solid #ccc; border-radius:8px; font-size:14px; box-shadow:0 1px 3px rgba(0,0,0,0.1); }
    .search-bar input:focus { outline:none; border-color:#007bff; box-shadow:0 0 0 2px rgba(0,123,255,0.2); }

    /* Tasks Grid */
    .tasks-list { display:grid; grid-template-columns: repeat(auto-fill,minmax(300px,1fr)); gap:20px; }
    .task-card {
      background:#fff; border-radius:12px; box-shadow:0 4px 15px rgba(0,0,0,0.05);
      display:flex; flex-direction:column; padding:20px;
    }
    .task-card-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; }
    .task-card-header h2 { font-size:1.25rem; color:#4CAF50; }
    .order-info { font-size:0.9rem; color:#777; }
    .badge { padding:6px 10px; border-radius:8px; font-size:13px; font-weight:bold; }
    .badge-completed { background-color:#d4edda; color:#155724; }
    .badge-pending { background-color:#fff3cd; color:#856404; }
    .badge-in-progress { background-color:#007bff; color:#fff; }

    .due-date { font-size:0.95rem; margin-bottom:10px; color:#777; }
    .task-steps { list-style:none; margin-bottom:15px; }
    .task-steps li { display:flex; align-items:center; font-size:0.95rem; margin-bottom:8px; }
    .task-steps li.completed { text-decoration:line-through; color:#999; }
    .task-steps input { margin-right:8px; accent-color:#007bff; }

    .task-card-footer { margin-top:auto; display:flex; justify-content:space-between; align-items:center; }
    .last-updated { font-size:0.8rem; color:#777; }
    .btn-details { background:none; border:none; color:#007bff; cursor:pointer; font-size:0.95rem; }

    /* Modal */
    .modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.5); display:flex; justify-content:center; align-items:center; z-index:1000; }
    .modal-overlay.hidden { display:none; }
    .modal { background:#fff; border-radius:12px; padding:30px; max-width:500px; width:90%; box-shadow:0 4px 15px rgba(0,0,0,0.05); position:relative; }
    .modal-close { position:absolute; top:15px; right:15px; background:none; border:none; font-size:1.5rem; cursor:pointer; }
    .modal-order, .modal-dates { margin:10px 0; color:#777; }
    .modal-steps h4 { margin-top:20px; color:#2a2a2a; }
    .modal-steps ul { list-style:none; padding:0; margin-bottom:15px; }
    .modal-steps li { margin-bottom:8px; font-size:0.95rem; }
    .progress-container { background:#eee; border-radius:8px; height:12px; overflow:hidden; margin-bottom:8px; }
    .progress-bar { width:0; height:100%; background:#28a745; transition:width 0.5s ease-in-out; }
    #modal-percent { font-size:0.9rem; color:#777; }
  </style>
</head>





<body>
  <nav class="navbar">
    <div class="navbar-menu-wrapper">
      <img src="logo.png" class="logo" alt="Company Logo">
      <div class="navbar-menu">
        <a href="#">Αρχική</a>
        <a href="#" class="active">Εργασίες</a>
        <a href="#">Αποθήκη</a>
        <a href="#">Παραγγελίες</a>
      </div>
    </div>
    <div class="navbar-right">
      <span class="welcome-text">Καλώς ήρθες, <span id="fullname"></span>!</span>
      <img src="profile.jpg" class="profile-img" alt="User Profile">
      <button class="logout-btn">Αποσύνδεση</button>
    </div>
  </nav>

  <div class="main-content">
    <div class="heading-row">
      <h1>Εργασίες</h1>
      <button class="btn-new-task">+ Νέα Εργασία</button>
    </div>
    <div class="search-bar">
      <input type="text" placeholder="Αναζήτηση εργασιών..." />
    </div>

    <section class="tasks-list">
      <!-- Κάρτα 1 -->
      <article class="task-card">
        <div class="task-card-header">
          <div>
            <h2>Κατασκευή σκελετών ομπρελών</h2>
            <small class="order-info">Παραγγελία: #2 – Προϊόν #2</small>
          </div>
          <span class="badge badge-in-progress">Σε εξέλιξη</span>
        </div>
        <div class="task-card-body">
          <p class="due-date">Προθεσμία: <time datetime="2023-04-20">20/04/2023</time></p>
          <ul class="task-steps">
            <li class="completed"><input type="checkbox" checked /> Κοπή μεταλλικών μερών</li>
            <li><input type="checkbox" /> Συναρμολόγηση σκελετού</li>
            <li><input type="checkbox" /> Έλεγχος ποιότητας</li>
          </ul>
        </div>
        <div class="task-card-footer">
          <small class="last-updated">15/04/2023</small>
          <button class="btn-details">Λεπτομέρειες</button>
        </div>
      </article>

      <!-- Κάρτα 2 -->
      <article class="task-card">
        <div class="task-card-header">
          <div>
            <h2>Ραφή υφασμάτων για ομπρέλες</h2>
            <small class="order-info">Παραγγελία: #2 – Προϊόν #2</small>
          </div>
          <span class="badge badge-pending">Εκκρεμεί</span>
        </div>
        <div class="task-card-body">
          <p class="due-date">Προθεσμία: <time datetime="2023-04-25">25/04/2023</time></p>
          <ul class="task-steps">
            <li><input type="checkbox" /> Κοπή υφάσματος</li>
            <li><input type="checkbox" /> Ραφή περιμετρικά</li>
            <li><input type="checkbox" /> Προσθήκη λογοτύπου</li>
          </ul>
        </div>
        <div class="task-card-footer">
          <small class="last-updated">–</small>
          <button class="btn-details">Λεπτομέρειες</button>
        </div>
      </article>

      <!-- Κάρτα 3 -->
      <article class="task-card">
        <div class="task-card-header">
          <div>
            <h2>Συσκευασία τελικών προϊόντων</h2>
            <small class="order-info">Παραγγελία: #2 – Προϊόν #2</small>
          </div>
          <span class="badge badge-completed">Ολοκληρώθηκε</span>
        </div>
        <div class="task-card-body">
          <p class="due-date">Προθεσμία: <time datetime="2023-04-18">18/04/2023</time></p>
          <ul class="task-steps">
            <li class="completed"><input type="checkbox" checked /> Έλεγχος ποιότητας</li>
            <li class="completed"><input type="checkbox" checked /> Τοποθέτηση σε συσκευασία</li>
            <li class="completed"><input type="checkbox" checked /> Σήμανση και αποθήκευση</li>
          </ul>
        </div>
        <div class="task-card-footer">
          <small class="last-updated">17/04/2023</small>
          <button class="btn-details">Λεπτομέρειες</button>
        </div>
      </article>
    </section>
  </div>

  <div class="progress-container">
    <div id="modal-progress" class="progress-bar" style="width: 0%"></div>
  </div>
  <span id="modal-percent">0%</span>


    <!-- Modal overlay -->
<div id="task-modal-overlay" class="modal-overlay hidden">
  <div class="modal">
    <button id="modal-close" class="modal-close">×</button>
    <div id="modal-content">
      <h3 id="modal-title"></h3>
      <p class="modal-order" id="modal-order"></p>
      <p class="modal-dates">
        Προθεσμία: <span id="modal-due"></span> |
        Τελευταία ενημέρωση: <span id="modal-updated"></span>
      </p>
      <div class="modal-steps">
        <h4>Βήματα Εργασίας</h4>
        <ul id="modal-step-list"></ul>
        <div class="progress-container">
          <div id="modal-progress" class="progress-bar"></div>
        </div>
        <span id="modal-percent">0%</span>
      </div>
    </div>
  </div>
</div>
<!-- New Task Modal -->
<div id="new-task-overlay" class="modal-overlay hidden">
  <div class="modal">
    <button id="new-modal-close" class="modal-close">×</button>
    <h3>Δημιουργία Νέας Εργασίας</h3>
    <form id="new-task-form">
      <label>Τίτλος:<br>
        <input type="text" name="title" required>
      </label><br>
      <label>Παραγγελία / Προϊόν:<br>
        <input type="text" name="orderInfo" required placeholder="#2 – Προϊόν #2">
      </label><br>
      <label>Προθεσμία:<br>
        <input type="date" name="dueDate" required>
      </label><br>
      <fieldset>
        <legend>Βήματα Εργασίας</legend>
        <div id="steps-container">
          <!-- αρχικά ένα step -->
          <div class="step-item">
            <input type="text" name="step" placeholder="Βήμα 1" required>
            <button type="button" class="remove-step">–</button>
          </div>
        </div>
        <button id="add-step" type="button">+ Προσθήκη Βήματος</button>
      </fieldset>
      <button type="submit" class="btn-new-task">Αποθήκευση</button>
    </form>
  </div>
</div>




<script src="../../javascript/menu-loader.js"></script>
<script src="../../javascript/navigations.js"></script>
<script>
  // Όλες οι εργασίες
  document.querySelectorAll('.task-card').forEach(card => {
    const badge = card.querySelector('.badge');
    const checkboxes = card.querySelectorAll('ul.task-steps input[type="checkbox"]');
    const stepItems = card.querySelectorAll('ul.task-steps li');
  
    // Συνάρτηση ενημέρωσης κατάστασης κάρτας
    function updateCardStatus() {
const checked = Array.from(checkboxes).filter(cb => cb.checked).length;
const total = checkboxes.length;

if(checked === total) {
  badge.className = 'badge badge-completed';
  badge.textContent = 'Ολοκληρώθηκε';
} else if(checked > 0) {
  badge.className = 'badge badge-in-progress';
  badge.textContent = 'Σε εξέλιξη';
} else {
  badge.className = 'badge badge-pending';
  badge.textContent = 'Εκκρεμεί';
}

// Ενημέρωση ποσοστού αν το modal είναι ανοιχτό
const activeModal = document.querySelector('.modal-overlay:not(.hidden)');
if(activeModal) {
  const percentage = total > 0 ? Math.round((checked / total) * 100) : 0;
  activeModal.querySelector('#modal-progress').style.width = `${percentage}%`;
  activeModal.querySelector('#modal-percent').textContent = `${percentage}%`;
}
}
  
    // Συνάρτηση για toggle διάστικτου
    function updateLineThrough(cb, li) {
      if (cb.checked) {
        li.classList.add('completed');
      } else {
        li.classList.remove('completed');
      }
    }
  
    // Πρόσθεσε listener σε κάθε checkbox
    checkboxes.forEach((cb, idx) => {
      // αρχικοποίηση εμφάνισης
      updateLineThrough(cb, stepItems[idx]);
      //listener
      cb.addEventListener('change', () => {
        // 1) ενημέρωση line-through
        updateLineThrough(cb, stepItems[idx]);
        // 2) ενημέρωση badge
        updateCardStatus();
        // -- εδώ μπορείς να στείλεις και PATCH στο API αν θέλεις --
      });
    });
  
    // αρχική ρύθμιση badge
    updateCardStatus();
  });
  </script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // Ορισμός συναρτήσεων ΠΡΙΝ από τη χρήση τους
  const initTaskCard = (card) => { /* ... */ };
  const addModalListeners = (card) => { /* ... */ };
  // Αρχικοποίηση υπαρχουσών καρτών
  document.querySelectorAll('.task-card').forEach(card => {
    initTaskCard(card);
    addModalListeners(card);
  })})
    // Λειτουργία Checkbox
    const initTaskCard = (card) => {
  const badge = card.querySelector('.badge');
  const checkboxes = card.querySelectorAll('input[type="checkbox"]');
  const steps = card.querySelectorAll('.task-steps li');
  const lastUpdated = card.querySelector('.last-updated');

  const updateStatus = () => {
    const checked = Array.from(checkboxes).filter(cb => cb.checked).length;
    const total = checkboxes.length;
    const percentage = total > 0 ? Math.round((checked / total) * 100) : 0;
    
    // Ενημέρωση badge
    if(checked === total) {
      badge.className = 'badge badge-completed';
      badge.textContent = 'Ολοκληρώθηκε';
    } else if(checked > 0) {
      badge.className = 'badge badge-in-progress';
      badge.textContent = 'Σε εξέλιξη';
    } else {
      badge.className = 'badge badge-pending';
      badge.textContent = 'Εκκρεμεί';
    }
    
    // Ενημέρωση ημερομηνίας
    lastUpdated.textContent = new Date().toLocaleDateString('el-GR');
    
    // Ενημέρωση modal αν είναι ανοιχτό
    const activeModal = document.querySelector('.modal-overlay:not(.hidden)');
    if(activeModal) {
      activeModal.querySelector('#modal-progress').style.width = `${percentage}%`;
      activeModal.querySelector('#modal-percent').textContent = `${percentage}%`;
    }
  };

  checkboxes.forEach((checkbox, index) => {
    checkbox.addEventListener('change', () => {
      steps[index].classList.toggle('completed', checkbox.checked);
      updateStatus();
    });
  });
  
  // Αρχικοποίηση κατάστασης
  checkboxes.forEach((checkbox, index) => {
    steps[index].classList.toggle('completed', checkbox.checked);
  });
  updateStatus();
};

    // Αρχικοποίηση υπαρχουσών καρτών
    document.querySelectorAll('.task-card').forEach(initTaskCard);

    // Λειτουργία Modal Λεπτομερειών
    document.querySelectorAll('.btn-details').forEach(btn => {
      btn.addEventListener('click', () => {
        const card = btn.closest('.task-card');
        const modal = document.getElementById('task-modal-overlay');
        
            // Συλλογή δεδομένων
            const checkboxes = card.querySelectorAll('input[type="checkbox"]');
            const checked = Array.from(checkboxes).filter(cb => cb.checked).length;
            const total = checkboxes.length;
            const percentage = total > 0 ? Math.round((checked / total) * 100) : 0;

            // Ενημέρωση προόδου
            modal.querySelector('#modal-progress').style.width = `${percentage}%`;
            modal.querySelector('#modal-percent').textContent = `${percentage}%`;
        
        // Συμπλήρωση περιεχομένου modal
        modal.querySelector('#modal-title').textContent = card.querySelector('h2').textContent;
        modal.querySelector('#modal-order').textContent = card.querySelector('.order-info').textContent;
        modal.querySelector('#modal-due').textContent = card.querySelector('.due-date time').textContent;
        modal.querySelector('#modal-updated').textContent = card.querySelector('.last-updated').textContent;
        
        modal.classList.remove('hidden');
      });
    });

    // Λειτουργία Νέας Εργασίας
    document.querySelector('.btn-new-task').addEventListener('click', () => {
      document.getElementById('new-task-overlay').classList.remove('hidden');
    });

    // Κλείσιμο Modals
    document.querySelectorAll('.modal-close').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.modal-overlay').forEach(modal => {
          modal.classList.add('hidden');
        });
      });
    });

    // Δυναμική προσθήκη βημάτων
    document.getElementById('add-step').addEventListener('click', () => {
      const container = document.getElementById('steps-container');
      const newStep = document.createElement('div');
      newStep.className = 'step-item';
      newStep.innerHTML = `
        <input type="text" name="step" required placeholder="Βήμα ${container.children.length + 1}">
        <button type="button" class="remove-step">–</button>
      `;
      container.appendChild(newStep);
      
      newStep.querySelector('.remove-step').addEventListener('click', () => {
        newStep.remove();
      });
    });

    document.getElementById('new-task-form').addEventListener('submit', (e) => {
  e.preventDefault();
  const formData = new FormData(e.target);
  
  // Δημιουργία νέας κάρτας
  const newCard = document.createElement('article');
  newCard.className = 'task-card';
  newCard.innerHTML = `
    <div class="task-card-header">
      <div>
        <h2>${formData.get('title')}</h2>
        <small class="order-info">${formData.get('orderInfo')}</small>
      </div>
      <span class="badge badge-pending">Εκκρεμεί</span>
    </div>
    <div class="task-card-body">
      <p class="due-date">Προθεσμία: <time datetime="${formData.get('dueDate')}">${new Date(formData.get('dueDate')).toLocaleDateString('el-GR')}</time></p>
      <ul class="task-steps">
        ${Array.from(formData.getAll('step')).map(step => `
          <li><input type="checkbox" /> ${step}</li>
        `).join('')}
      </ul>
    </div>
    <div class="task-card-footer">
      <small class="last-updated">${new Date().toLocaleDateString('el-GR')}</small>
      <button class="btn-details">Λεπτομέρειες</button>
    </div>
  `;

  // Προσθήκη νέας κάρτας
  document.querySelector('.tasks-list').prepend(newCard);
  
  // Αρχικοποίηση λειτουργιών
  initTaskCard(newCard);
  addModalListeners(newCard); // Προσθήκη λειτουργίας modal
  
  // Επαναφορά φόρμας
  e.target.reset();
  document.getElementById('new-task-overlay').classList.add('hidden');
});

const addModalListeners = (card) => {
  card.querySelector('.btn-details').addEventListener('click', () => {
    const modal = document.getElementById('task-modal-overlay');
    const checkboxes = card.querySelectorAll('input[type="checkbox"]');
    
    // Συμπλήρωση περιεχομένου modal
    modal.querySelector('#modal-title').textContent = card.querySelector('h2').textContent;
    modal.querySelector('#modal-order').textContent = card.querySelector('.order-info').textContent;
    modal.querySelector('#modal-due').textContent = card.querySelector('.due-date time').textContent;
    modal.querySelector('#modal-updated').textContent = card.querySelector('.last-updated').textContent;
    
    // Λίστα βημάτων
    const stepList = modal.querySelector('#modal-step-list');
    stepList.innerHTML = '';
    card.querySelectorAll('.task-steps li').forEach(li => {
      const newLi = document.createElement('li');
      newLi.textContent = li.textContent;
      if(li.classList.contains('completed')) newLi.style.textDecoration = 'line-through';
      stepList.appendChild(newLi);
    });
    
    // Ενημέρωση προόδου
    const checked = Array.from(checkboxes).filter(cb => cb.checked).length;
    const total = checkboxes.length;
    const percentage = total > 0 ? Math.round((checked / total) * 100) : 0;
    modal.querySelector('#modal-progress').style.width = `${percentage}%`;
    modal.querySelector('#modal-percent').textContent = `${percentage}%`;
    
    modal.classList.remove('hidden');
  });
};
  </script>
</body>
</html>
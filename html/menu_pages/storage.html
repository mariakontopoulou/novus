<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Storage</title>
    <link rel="stylesheet" href="/../../css/pages.css" />
    <link rel="stylesheet" href="/../../css/storage.css" />
    <link rel="stylesheet" href="/../../css/menu.css">
  </head>

  <body>
    <div id="menu"></div>
    <div class="main-content">
      <h1 id="StHeader">Î‘Ï€Î¿Î¸Î®ÎºÎ·</h1>
      <input type="Text" placeholder="ğŸ” Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î ÏÏÏ„Ï‰Î½ Î¥Î»ÏÎ½" />
      <button onclick="window.location.href='update-storage.html'">Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î¥Î»Î¹ÎºÎ¿Ï +</button>
    </div>
    <div class="Main-table">
        <table id="materialsTable">
            <thead>
                <tr>
                    <th>ÎŒÎ½Î¿Î¼Î±</th>
                    <th>Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®</th>
                    <th>Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Î‘Ï€ÏŒÎ¸ÎµÎ¼Î±</th>
                    <th>ÎœÎ¿Î½Î¬Î´Î±</th>
                    <th>ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·</th>
                    <th>Î ÏÎ¿Î¼Î·Î¸ÎµÏ…Ï„Î®Ï‚</th>
                    <th>Î•Î½Î­ÏÎ³ÎµÎ¹ÎµÏ‚</th>
                </tr>
            </thead>
            <tbody
                
            </tbody>
        </table>
    </div>

    <script src="../../javascript/menu-loader.js"></script>
    <script src="../../javascript/navigations.js"></script>
    <script>
      window.addEventListener('load', () => {
      const materials = JSON.parse(localStorage.getItem('materials')) || [];
      const tbody = document.querySelector('#materialsTable tbody');

      materials.forEach(mat => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${mat.name}</td>
          <td>${mat.description}</td>
          <td>${mat.stock}</td>
          <td>${mat.unit}</td>
          <td>${mat.status}</td>
          <td>${mat.supplier}</td>
          <td><button onclick="window.location.reload()">Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ·</button></td>
        `;
        tbody.appendChild(tr);
      });
    });
    </script>
    <script>
    let materials = JSON.parse(localStorage.getItem('materials')) || [];

    function renderTable() {
        const tbody = document.querySelector('#materialsTable tbody');
        tbody.innerHTML = '';
        materials.forEach((mat, i) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${mat.name}</td>
            <td>${mat.description}</td>
            <td id="stock-${i}">${mat.stock}</td>
            <td>${mat.unit}</td>
            <td>${mat.status}</td>
            <td>${mat.supplier}</td>
            <td>
            <button class="stock-btn" onclick="editStock(${i})">Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ·</button>
            </td>
        `;
        tbody.appendChild(tr);
        });
    }

    function editStock(idx) {
        const cell = document.getElementById(`stock-${idx}`);
        const old = materials[idx].stock;
        cell.innerHTML = `
            <div class="stock-edit-wrapper">
                <input
                type="number"
                id="input-stock-${idx}"
                class="stock-input"
                value="${old}"
                min="0"
            >
            <button
                onclick="saveStock(${idx})"
                class="save-stock-btn"
                title="Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Î½Î­Î±Ï‚ Ï„Î¹Î¼Î®Ï‚"
            >OK</button>
        </div>
  `;
   }
    function saveStock(idx) {
        const input = document.getElementById(`input-stock-${idx}`);
        const val = Number(input.value);
        if (isNaN(val) || val < 0) return alert('Î’Î¬Î»Îµ Î¼Î· Î±ÏÎ½Î·Ï„Î¹ÎºÏŒ Î±ÏÎ¹Î¸Î¼ÏŒ');
        if (val === 0) {
        materials.splice(idx,1);
        } else {
        materials[idx].stock = val;
        }
        localStorage.setItem('materials', JSON.stringify(materials));
        renderTable();
    }

    window.addEventListener('load', renderTable);
  
    </script>
  </body>
</html>